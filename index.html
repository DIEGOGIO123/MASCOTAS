<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reporte de Mascotas Perdidas</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #c5fcd4;
      color: #444;
    }
    .container {
      max-width: 95%;
      margin: 20px auto;
      background-color: #b5ccec;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      position: relative;
    }
    h1 {
      color: #e67e22;
      text-align: center;
      margin-bottom: 20px;
      font-size: 2em;
    }
    p.description {
      text-align: center;
      margin-bottom: 25px;
      color: #555;
    }
    #map {
      height: 400px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      margin-bottom: 20px;
      width: 100%;
    }
    #search-toggle {
      position: absolute;
      top: 20px;
      right: 20px;
      background: white;
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      cursor: pointer;
      font-size: 24px;
      z-index: 1001;
    }
    #search-toggle:hover {
      background-color: #e0e0e0;
      transform: scale(1.1);
    }
    #search-panel {
      display: none;
      position: absolute;
      top: 80px;
      right: 20px;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      width: 300px;
      z-index: 1000;
    }
    #search-panel label {
      margin-top: 10px;
      display: block;
      font-weight: bold;
    }
    #search-panel input, #search-panel select {
      width: 100%;
      padding: 6px;
      margin-top: 5px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    #buscar-mascota {
      background-color: #3498db;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 8px;
      cursor: pointer;
      width: 100%;
    }
    #buscar-mascota:hover {
      background-color: #2980b9;
    }
    .card {
      background: linear-gradient(135deg, #e0f7fa, #b2ebf2);
      padding: 20px;
      border-radius: 12px;
      margin-top: 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }
    .card img {
      max-width: 100%;
      border-radius: 8px;
      margin-top: 10px;
    }
    .custom-marker {
      background: none !important;
      border: none !important;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>üêæ Reporte de Mascotas Perdidas</h1>
    <p class="description">Selecciona una ubicaci√≥n y realiza tu b√∫squeda.</p>

    <button id="search-toggle">üîç</button>

    <div id="search-panel">
      <h3 style="margin-top:0;">Buscar Mascota</h3>
      <label>Tipo de mascota:</label>
      <select id="tipo">
        <option value="perro">Perro</option>
        <option value="gato">Gato</option>
      </select>

      <label>Alcald√≠a:</label>
      <select id="alcaldia">
        <option value="">--Selecciona--</option>
        <option>Gustavo A. Madero</option>
        <option>Azcapotzalco</option>
        <option>Ecatepec</option>
      </select>

      <div id="form-perro">
        <label>Color(es):</label>
        <input type="text" id="color" placeholder="Ej. blanco, caf√©">
        <label>Tama√±o:</label>
        <select id="tamano">
          <option value="">--Selecciona--</option>
          <option>Peque√±o</option>
          <option>Mediano</option>
          <option>Grande</option>
        </select>
        <label>Raza:</label>
        <input type="text" id="raza" placeholder="Ej. Chihuahua">
        <label>¬øCaracter√≠stica especial?</label>
        <input type="text" id="caracteristica" placeholder="Ej. Cojea de la pata trasera">
        <label>Subir foto:</label>
        <input type="file" id="foto" accept="image/*">
      </div>

      <div id="form-gato" style="display:none;">
        <label>Pelaje:</label>
        <select id="pelaje">
          <option value="">--Selecciona--</option>
          <option>Corto</option>
          <option>Largo</option>
        </select>
        <label>Color de ojos:</label>
        <input type="text" id="ojos" placeholder="Ej. verde, azul">
        <label>Raza:</label>
        <input type="text" id="razaGato" placeholder="Ej. Persa, Siam√©s">
        <label>¬øTiene collar?</label>
        <select id="collar">
          <option value="">--Selecciona--</option>
          <option>S√≠</option>
          <option>No</option>
        </select>
        <label>Subir foto:</label>
        <input type="file" id="fotoGato" accept="image/*">
      </div>

      <button id="buscar-mascota">Buscar</button>
    </div>

    <div id="map"></div>
    <div id="report-container"></div>
  </div>

  <script>
    const map = L.map('map').setView([19.49, -99.12], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '¬© OpenStreetMap contributors'
    }).addTo(map);

    const locationsInfo = {
      "Gustavo A. Madero": [19.5020, -99.1118],
      "Azcapotzalco": [19.4753, -99.191],
      "Ecatepec": [19.5016, -99.0420]
    };

    for (const location in locationsInfo) {
      const coords = locationsInfo[location];
      L.marker(coords, {
        icon: L.divIcon({
          className: 'custom-marker',
          html: '<i style="color: #e67e22; font-size: 2em;">üê∂üê±</i>'
        })
      }).addTo(map).bindPopup(`Reporte de mascotas perdidas en ${location}`);
    }

    document.getElementById('search-toggle').addEventListener('click', function () {
      const panel = document.getElementById('search-panel');
      panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
    });

    document.getElementById('tipo').addEventListener('change', function () {
      const tipo = this.value;
      document.getElementById('form-perro').style.display = tipo === 'perro' ? 'block' : 'none';
      document.getElementById('form-gato').style.display = tipo === 'gato' ? 'block' : 'none';
    });

    function fechaAleatoria() {
      const inicio = new Date('2025-01-01');
      const fin = new Date('2025-04-27');
      const diff = fin.getTime() - inicio.getTime();
      const randomDate = new Date(inicio.getTime() + Math.random() * diff);
      return randomDate.toISOString().split('T')[0];
    }

    const coordenadasLugares = {
      "Parque Tezoz√≥moc": [19.485, -99.190],
      "UAM Azcapotzalco": [19.506, -99.185],
      "Town Center El Rosario": [19.497, -99.203],
      "Metro El Rosario": [19.500, -99.210],
      "Parque Nacional El Tepeyac": [19.490, -99.110],
      "Bas√≠lica de Guadalupe": [19.484, -99.117],
      "Metro Indios Verdes": [19.504, -99.136],
      "Deportivo Carmen Serd√°n": [19.517, -99.122],
      "V√≠a Morelos": [19.531, -99.048],
      "Centro Las Am√©ricas": [19.541, -99.030],
      "Plaza Arag√≥n": [19.520, -99.036],
      "Ciudad Azteca": [19.529, -99.042]
    };

    const iconoMascota = L.icon({
      iconUrl: 'https://cdn-icons-png.flaticon.com/512/684/684908.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32],
      popupAnchor: [0, -32]
    });

    let marcadoresResultados = [];
    function limpiarMarcadoresResultados() {
      marcadoresResultados.forEach(marker => map.removeLayer(marker));
      marcadoresResultados = [];
    }

    document.getElementById('buscar-mascota').addEventListener('click', function () {
      const tipo = document.getElementById('tipo').value;
      const alcaldia = document.getElementById('alcaldia').value;
      const container = document.getElementById('report-container');
      container.innerHTML = '';
      limpiarMarcadoresResultados();

      const lugares = {
        "Azcapotzalco": ["Parque Tezoz√≥moc", "UAM Azcapotzalco", "Town Center El Rosario", "Metro El Rosario"],
        "Gustavo A. Madero": ["Parque Nacional El Tepeyac", "Bas√≠lica de Guadalupe", "Metro Indios Verdes", "Deportivo Carmen Serd√°n"],
        "Ecatepec": ["V√≠a Morelos", "Centro Las Am√©ricas", "Plaza Arag√≥n", "Ciudad Azteca"]
      };

      const numResultados = Math.floor(Math.random() * 2) + 2;

      for (let i = 0; i < numResultados; i++) {
        const fecha = fechaAleatoria();
        const lugar = lugares[alcaldia][Math.floor(Math.random() * lugares[alcaldia].length)];
        const coords = coordenadasLugares[lugar];

        let resultado = '';
        if (tipo === 'perro') {
          const color = document.getElementById('color').value;
          const tamano = document.getElementById('tamano').value;
          const raza = document.getElementById('raza').value;
          const caracteristica = document.getElementById('caracteristica').value;
          const foto = document.getElementById('foto').files[0];
          let fotoHTML = '';
          if (foto) {
            const imgURL = URL.createObjectURL(foto);
            fotoHTML = `<img src="${imgURL}" alt="Foto perro">`;
          }
          resultado = `
            <div class="card">
              <h2>üê∂ Perro encontrado</h2>
              <p><strong>Fecha:</strong> ${fecha}</p>
              <p><strong>Alcald√≠a:</strong> ${alcaldia}</p>
              <p><strong>Color:</strong> ${color}</p>
              <p><strong>Tama√±o:</strong> ${tamano}</p>
              <p><strong>Raza:</strong> ${raza}</p>
              ${caracteristica ? `<p><strong>Caracter√≠stica:</strong> ${caracteristica}</p>` : ''}
              <p><em>√öltima vez visto cerca de <strong>${lugar}</strong></em></p>
              ${fotoHTML}
            </div>
          `;
        } else {
          const pelaje = document.getElementById('pelaje').value;
          const ojos = document.getElementById('ojos').value;
          const razaGato = document.getElementById('razaGato').value;
          const collar = document.getElementById('collar').value;
          const fotoGato = document.getElementById('fotoGato').files[0];
          let fotoHTML = '';
          if (fotoGato) {
            const imgURL = URL.createObjectURL(fotoGato);
            fotoHTML = `<img src="${imgURL}" alt="Foto gato">`;
          }
          resultado = `
            <div class="card">
              <h2>üê± Gato encontrado</h2>
              <p><strong>Fecha:</strong> ${fecha}</p>
              <p><strong>Alcald√≠a:</strong> ${alcaldia}</p>
              <p><strong>Pelaje:</strong> ${pelaje}</p>
              <p><strong>Color de ojos:</strong> ${ojos}</p>
              <p><strong>Raza:</strong> ${razaGato}</p>
              <p><strong>¬øTiene collar?</strong> ${collar}</p>
              <p><em>√öltima vez visto cerca de <strong>${lugar}</strong></em></p>
              ${fotoHTML}
            </div>
          `;
        }

        container.innerHTML += resultado;

        // Agregar marcador en el mapa
        if (coords) {
          const marker = L.marker(coords, { icon: iconoMascota }).addTo(map);
          marker.bindPopup(`<strong>${tipo === 'perro' ? 'üê∂ Perro' : 'üê± Gato'}</strong><br>${lugar}<br>Fecha: ${fecha}`);
          marcadoresResultados.push(marker);
        }
      }

      if (marcadoresResultados.length > 0) {
        map.setView(marcadoresResultados[0].getLatLng(), 14);
      }

      document.getElementById('search-panel').style.display = 'none';
    });
  </script>
</body>
</html>
